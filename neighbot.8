.Dd February 23, 2026
.Dt NEIGHBOT 8
.Os
.Sh NAME
.Nm neighbot
.Nd network neighbor monitoring daemon
.Sh SYNOPSIS
.Nm
.Op Fl d
.Op Fl f Ar dbfile
.Op Fl i Ar iface
.Op Fl m Ar mailto
.Op Fl p
.Op Fl q
.Op Fl s Ar sendmail
.Op Fl u Ar user
.Sh DESCRIPTION
.Nm
passively monitors ARP (IPv4) and NDP (IPv6) traffic on all Ethernet
interfaces.
It maintains a database of IP-to-MAC address mappings and sends email
alerts when new stations appear or existing mappings change.
Notifications include reverse DNS hostname, hardware vendor
(from the OUI database, if available), and timestamps.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl d
Daemonize.
Detach from the terminal and log to syslog instead of stderr.
.It Fl f Ar dbfile
Path to the database file.
Default:
.Pa /var/neighbot/neighbot.csv .
.It Fl i Ar iface
Monitor only the specified interface instead of all Ethernet interfaces.
.It Fl m Ar mailto
Email recipient for notifications.
Default:
.Ql root .
.It Fl p
Disable active probing.
By default, when a known MAC address appears at a new IP,
.Nm
sends ARP requests or NDP Neighbor Solicitations to the old IP
to determine whether the device moved (old IP dead) or has
multiple addresses (both active).
Probes use a zero source address to avoid polluting ARP/NDP caches.
This flag makes
.Nm
purely passive.
.It Fl q
Quiet mode.
Suppress email notifications.
Events are still logged.
.It Fl s Ar sendmail
Path to the sendmail-compatible mail program used for notifications.
Default:
.Pa /usr/sbin/sendmail .
.It Fl u Ar user
Drop privileges to
.Ar user
after opening packet capture handles.
The database directory and file are chowned to this user before
dropping.
Default:
.Ql nobody .
.El
.Sh EVENTS
.Nm
generates the following event types:
.Bl -tag -width "flip-flop"
.It new
A previously unknown IP address is seen for the first time.
.It changed
An IP address is seen with a different MAC address than the one
previously recorded.
.It flip-flop
An IP address alternates between two previously seen MAC addresses.
This typically indicates VRRP/HSRP failover, dual-homed hosts,
or ARP spoofing.
.It reappeared
A known MAC/IP pair is seen again after more than 6 months of silence.
.It bogon
An IP address is seen that does not belong to any subnet configured
on the receiving interface.
This may indicate ARP or NDP spoofing.
Bogon packets are not added to the database.
.It moved
A MAC address is seen at a new IP address while its old IP no longer
responds to probes (requires active probing).
.El
.Sh DATABASE FORMAT
The database is a CSV file with the following fields:
.Pp
.D1 ip,mac,interface,first_seen,last_seen,prev_mac
.Pp
The
.Ar prev_mac
field stores the previous MAC address for flip-flop detection.
Old database files without this field are loaded without errors.
.Pp
Timestamps are in ISO 8601 format (local time).
The database is saved atomically via a temporary file and rename.
.Pp
The maximum number of entries is limited to 100000 to prevent
memory exhaustion from spoofed traffic.
.Sh SIGNALS
.Bl -tag -width SIGTERM
.It Dv SIGHUP
Save the database to disk.
.It Dv SIGTERM , Dv SIGINT
Save the database and exit.
.It Dv SIGUSR1
Dump active probe state to the log.
.It Dv SIGPIPE
Ignored.
.El
.Sh FILES
.Bl -tag -width "/var/neighbot/neighbot.csv"
.It Pa /var/neighbot/neighbot.csv
Default database file.
.It Pa /var/neighbot/oui.txt
OUI vendor database, installed automatically by
.Sq make install .
If present, email notifications include the hardware vendor name
resolved from the MAC address prefix.
The file is loaded once at startup.
Use
.Sq make oui-update
to re-download, or add a daily cron job to keep it current.
.It Pa /etc/systemd/system/neighbot.service
Systemd unit file (Linux).
.It Pa /etc/rc.d/neighbot
rc.d script (OpenBSD).
.El
.Sh SECURITY
.Nm
drops to an unprivileged user
.Pq default: nobody
after opening packet capture handles.
All supplementary groups are dropped.
.Pp
On
.Ox ,
.Nm
additionally uses
.Xr pledge 2
and
.Xr unveil 2
to restrict its privileges after initialization.
.Pp
In quiet mode
.Pq Fl q ,
.Nm
pledges
.Cm stdio rpath wpath cpath
and unveils only the database directory.
.Pp
When email notifications are enabled,
.Nm
pledges
.Cm stdio rpath wpath cpath proc exec dns
and does not use
.Xr unveil 2
so that
.Xr sendmail 8
can access its configuration files.
.Sh EXIT STATUS
.Nm
exits 0 on clean shutdown, or 1 if no usable interfaces were found.
.Sh SEE ALSO
.Xr pledge 2 ,
.Xr unveil 2 ,
.Xr arpwatch 8 ,
.Xr tcpdump 8
.Sh AUTHORS
.An neighbot contributors
